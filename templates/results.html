{% extends "base.html" %}

{% block content %}

<section>
    <h1>Resultados</h1>

    <a href="{% url 'home' %}">VOLVER</a>
</section>

<br><br>

{% if status %}
    <section>
        <p>URL: {{data_1.url}}</p>
        <p>index: {{data_1.index}}</p>
        <p>interactive: {{data_1.interactive}}</p>
    </section>
    <br><br>
    <section>
        <p>URL: {{data_2.url}}</p>
        <p>index: {{data_2.index}}</p>
        <p>interactive: {{data_2.interactive}}</p>
    </section>
{% else %}
    <section>
        <p>Analizando las urls ...</p>
    </section>
{% endif %}

{% endblock content %}

{% block js %}
<script>
    let taskStatus = "{{ status }}"
    const tasksID_1 = "{{url_1_id}}"
    const tasksID_2 = "{{url_2_id}}"

    if(taskStatus == "False"){
        checkTaskStatus(tasksID_1, tasksID_2)
    }
    
    function checkTaskStatus(task1, task2){
        console.log("Fetching...")
        fetch('/check_task_status/?' + new URLSearchParams({
            task1: task1,
            task2: task2,
        }).toString())
        .then(response => response.json())
        .then(data => {
            console.log(data);
            if(data.status == "ready"){
                window.location.reload()
            }else{
                if(data.status == "almost"){
                    if(data.task == "task1"){
                        console.log("Ready task 1")
                    }else if(data.task == "task2"){
                        console.log("Ready task 2")
                    }
                }
                setTimeout(function() {
                    checkTaskStatus(tasksID_1, tasksID_2)
                }, 1500);
            }
        });
    }
</script>
{% endblock js %}
{% comment %} 
'speed': 'Speed Index shows how quickly the contents of a page are visibly populated.'
'interactive': 'Time to Interactive is the amount of time it takes for the page to become fully interactive.' 

▪ Speed Index
    • Green (Good) – 0 to 3400 seconds 
    • Orange (Moderate) – 3400 to 5800 seconds 
    • Red (Slow) – over 5800 seconds 
        
▪ Time to Interactive
    • Good - nothing to do here = TTI of 2468 milliseconds or less. 
    • Ok, but consider improvement = TTI between 2468 and 3280 milliseconds. 
    • Longer than recommended = TTI between 3280 and 4500 milliseconds. 


{% endcomment %}